import { useState, useEffect } from "react";
import {
  App,
  Card,
  Row,
  Col,
  Avatar,
  Tag,
  Button,
  Space,
  Select,
  Input,
  Modal,
  Form,
  Alert,
  Table,
  Popconfirm,
  Empty,
} from "antd";
import {
  PlusOutlined,
  EditOutlined,
  EyeOutlined,
  EnvironmentOutlined,
  TrophyOutlined,
  UserOutlined,
  HomeOutlined,
  SearchOutlined,
  EyeInvisibleOutlined,
  DeleteOutlined,
} from "@ant-design/icons";
import PersonDetailCard from "./PersonDetailCard";
import ArtisanSummaryCards from "./ArtisanSummaryCards";
import {
  getAdminArtisans,
  createArtisan,
  updateArtisan,
  deleteArtisan,
  getAdminUsers,
} from "../../services/adminApi";
import { getArtisans, getProvinces, getApiErrorMessage } from "../../services/api";

/** Chỉ chứa các field có trong API response /api/artisans/public */
interface Artisan {
  id: string;
  name: string;
  specialty: string;
  location: string;
  provinceId?: number;
  status: "ACTIVE" | "INACTIVE";
  profileImageUrl?: string;
  bio?: string;
  workshopAddress?: string;
  totalTours?: number;
  averageRating?: number;
  createdAt?: string;
}

export default function ArtisanManagement() {
  const { message } = App.useApp();
  const [artisans, setArtisans] = useState<Artisan[]>([]);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState<string | null>(null);
  const [fallbackNotice, setFallbackNotice] = useState<string | null>(null);

  const [filter, setFilter] = useState<{
    location: string;
    status: string;
    search: string;
  }>({
    location: "all",
    status: "all",
    search: "",
  });
  const [searchInput, setSearchInput] = useState("");

  const [isModalOpen, setIsModalOpen] = useState(false);
  const [detailModalOpen, setDetailModalOpen] = useState(false);
  const [editModalOpen, setEditModalOpen] = useState(false);
  const [selectedArtisan, setSelectedArtisan] = useState<Artisan | null>(null);
  const [provinces, setProvinces] = useState<{ id: number; name: string }[]>(
    [],
  );
  const [form] = Form.useForm();
  const [editForm] = Form.useForm();
  const [saving, setSaving] = useState(false);
  const [createLoading, setCreateLoading] = useState(false);
  const [userOptions, setUserOptions] = useState<{ id: number; fullName: string; email: string }[]>([]);

  const isFallbackMode = !!fallbackNotice;

  useEffect(() => {
    getProvinces().then((list) =>
      setProvinces(list.map((p) => ({ id: p.id, name: p.name }))),
    );
  }, []);

  const mapApiToArtisan = (item: unknown): Artisan => {
    const a = item as Record<string, unknown>;
    const province = a.province as { id?: number; name?: string } | undefined;
    const user = a.user as { avatarUrl?: string } | undefined;
    const provinceName = province?.name ?? "";
    const provinceId = province?.id;
    const isActive = a.isActive as boolean | undefined;
    const status = isActive === false ? "INACTIVE" : "ACTIVE";
    const profileImageUrl = (a.profileImageUrl as string) ?? (user?.avatarUrl as string) ?? "";
    return {
      id: String(a.id),
      name: (a.fullName as string) ?? "",
      specialty: (a.specialization as string) ?? "",
      location: provinceName,
      provinceId,
      status: status as "ACTIVE" | "INACTIVE",
      profileImageUrl,
      bio: (a.bio as string) ?? "",
      workshopAddress: (a.workshopAddress as string) ?? "",
      totalTours: (a.totalTours as number) ?? 0,
      averageRating: (a.averageRating as number) ?? 0,
      createdAt: (a.createdAt as string) ?? "",
    };
  };

  const fetchArtisans = async () => {
    try {
      setLoading(true);
      setError(null);
      setFallbackNotice(null);

      try {
        const { data } = await getAdminArtisans();
        const rawList = (data || []) as unknown[];
        setArtisans(rawList.map(mapApiToArtisan));
        } catch (adminErr: unknown) {
        try {
          const raw = await getArtisans();
          const apiArtisans = Array.isArray(raw) ? raw : [];
          setArtisans(apiArtisans.map(mapApiToArtisan));
          // Không set fallbackNotice → isFallbackMode = false → vẫn sửa/xóa được khi đã đăng nhập
        } catch (publicErr) {
          console.error("Fallback public API also failed:", publicErr);
          throw adminErr;
        }
      }
    } catch (err) {
      console.error("Error fetching artisans:", err);
      setError("Không thể tải dữ liệu nghệ nhân. Vui lòng thử lại sau.");
      message.error("Không thể tải dữ liệu nghệ nhân");
    } finally {
      setLoading(false);
    }
  };

  useEffect(() => {
    fetchArtisans();
  }, []);

  const provinceOptions = [
    ...provinces.map((p) => p.name),
    ...Array.from(new Set(artisans.map((a) => a.location).filter(Boolean))),
  ].filter(Boolean);
  const uniqueProvinces = Array.from(new Set(provinceOptions)).sort();

  const filteredArtisans = artisans.filter((artisan) => {
    if (filter.location !== "all" && artisan.location !== filter.location)
      return false;
    if (filter.status !== "all" && artisan.status !== filter.status)
      return false;
    if (filter.search?.trim()) {
      const q = filter.search.toLowerCase();
      return artisan.name?.toLowerCase().includes(q);
    }
    return true;
  });

  const hasActiveFilters =
    filter.location !== "all" ||
    filter.status !== "all" ||
    (filter.search?.trim()?.length ?? 0) > 0;

  const handleClearFilters = () => {
    setFilter({ location: "all", status: "all", search: "" });
    setSearchInput("");
  };

  const handleViewDetail = (record: Artisan) => {
    setSelectedArtisan(record);
    setDetailModalOpen(true);
  };

  const handleOpenEdit = (record: Artisan) => {
    setSelectedArtisan(record);
    editForm.setFieldsValue({
      fullName: record.name,
      specialization: record.specialty,
      bio: record.bio || "",
      profileImageUrl: record.profileImageUrl || "",
      workshopAddress: record.workshopAddress || "",
      provinceId: record.provinceId,
    });
    setEditModalOpen(true);
  };

  const handleOpenCreate = async () => {
    form.resetFields();
    setIsModalOpen(true);
    if (!isFallbackMode) {
      try {
        const { data } = await getAdminUsers({ limit: 500 });
        setUserOptions(
          (data || []).map((u) => ({
            id: u.id,
            fullName: u.fullName || u.username || `User #${u.id}`,
            email: u.email || "",
          })),
        );
      } catch {
        message.warning("Không thể tải danh sách user. Vui lòng thử lại.");
      }
    }
  };

  const handleCreateArtisan = async () => {
    if (isFallbackMode) return;
    try {
      const values = await form.validateFields();
      const selectedUser = userOptions.find((u) => u.id === values.userId);
      setCreateLoading(true);
      const payload: Record<string, unknown> = {
        userId: values.userId,
        fullName: values.fullName || selectedUser?.fullName || "Nghệ nhân",
        specialization: values.specialization,
      };
      if (values.bio?.trim()) payload.bio = values.bio.trim();
      if (values.workshopAddress?.trim()) payload.workshopAddress = values.workshopAddress.trim();
      if (values.profileImageUrl?.trim()) payload.profileImageUrl = values.profileImageUrl.trim();
      if (values.provinceId) payload.provinceId = values.provinceId;
      await createArtisan(payload as any);
      message.success("Đã thêm nghệ nhân thành công");
      setIsModalOpen(false);
      form.resetFields();
      fetchArtisans();
    } catch (err: unknown) {
      if ((err as { errorFields?: unknown[] })?.errorFields) return;
      const msg = getApiErrorMessage(err);
      console.error("[ArtisanManagement] createArtisan error:", err);
      message.error(msg || "Thêm nghệ nhân thất bại. Vui lòng thử lại.");
    } finally {
      setCreateLoading(false);
    }
  };

  const handleStatusChange = async (
    record: Artisan,
    newStatus: "ACTIVE" | "INACTIVE",
  ) => {
    if (isFallbackMode) {
      message.warning("Đang dùng dữ liệu fallback, không thể cập nhật.");
      return;
    }
    try {
      await updateArtisan(parseInt(record.id), {
        isActive: newStatus === "ACTIVE",
      });
      message.success("Cập nhật trạng thái thành công");
      if (selectedArtisan?.id === record.id) {
        setSelectedArtisan({ ...record, status: newStatus });
      }
      fetchArtisans();
    } catch (err) {
      message.error("Cập nhật trạng thái thất bại. Vui lòng thử lại.");
    }
  };

  const handleDeleteArtisan = async (record: Artisan) => {
    if (isFallbackMode) {
      message.warning("Đang dùng dữ liệu fallback, không thể xóa.");
      return;
    }
    try {
      await deleteArtisan(parseInt(record.id));
      message.success("Đã xóa nghệ nhân");
      setEditModalOpen(false);
      setSelectedArtisan(null);
      fetchArtisans();
    } catch (err) {
      message.error("Xóa nghệ nhân thất bại. Vui lòng thử lại.");
      throw err;
    }
  };

  const handleSaveEdit = async () => {
    if (!selectedArtisan || isFallbackMode) return;
    try {
      const values = await editForm.validateFields();
      setSaving(true);
      const payload: Record<string, unknown> = {
        fullName: values.fullName,
        specialization: values.specialization,
        bio: values.bio ?? "",
        workshopAddress: values.workshopAddress ?? "",
      };
      if (values.profileImageUrl?.trim()) {
        payload.profileImageUrl = values.profileImageUrl.trim();
      }
      if (values.provinceId) {
        payload.provinceId = values.provinceId;
      }
      await updateArtisan(parseInt(selectedArtisan.id), payload);
      message.success("Cập nhật nghệ nhân thành công");
      setEditModalOpen(false);
      setSelectedArtisan(null);
      fetchArtisans();
    } catch (err) {
      if (err && typeof err === "object" && "errorFields" in err) return;
      console.error("[ArtisanManagement] handleSaveEdit error:", err);
      message.error(getApiErrorMessage(err) || "Cập nhật thất bại. Vui lòng thử lại.");
    } finally {
      setSaving(false);
    }
  };

  /** Thống kê tính từ danh sách artisans trong state */
  const stats = {
    total: artisans.length,
    active: artisans.filter((a) => a.status === "ACTIVE").length,
    inactive: artisans.filter((a) => a.status === "INACTIVE").length,
    avgRating:
      artisans.length > 0
        ? (
            artisans.reduce((sum, a) => sum + (a.averageRating || 0), 0) /
            artisans.length
          ).toFixed(1)
        : "0.0",
  };

  const columns = [
    {
      title: "Nghệ nhân",
      key: "artisan",
      width: 220,
      fixed: "left" as const,
      render: (_: unknown, record: Artisan) => (
        <div style={{ display: "flex", alignItems: "center", gap: 12 }}>
          <Avatar
            size={48}
            src={record.profileImageUrl}
            style={{ backgroundColor: "#8B0000", flexShrink: 0 }}
            icon={!record.profileImageUrl ? <UserOutlined /> : undefined}
          />
          <div>
            <div
              style={{
                fontSize: 15,
                fontWeight: 600,
                color: "#262626",
                marginBottom: 2,
              }}
            >
              {record.name}
            </div>
            <div
              style={{
                fontSize: 12,
                color: "#8B0000",
                fontWeight: 500,
              }}
            >
              {record.specialty ? `Nghệ nhân ${record.specialty}` : "Nghệ nhân"}
            </div>
          </div>
        </div>
      ),
    },
    {
      title: "Chuyên môn",
      key: "specialty",
      width: 180,
      render: (_: unknown, record: Artisan) => (
        <div>
          <TrophyOutlined style={{ color: "#faad14", marginRight: 6 }} />
          <span style={{ fontWeight: 500 }}>{record.specialty}</span>
        </div>
      ),
    },
    {
      title: "Địa điểm",
      key: "location",
      width: 160,
      render: (_: unknown, record: Artisan) => (
        <div style={{ display: "flex", alignItems: "center", gap: 6 }}>
          <EnvironmentOutlined style={{ color: "#52c41a" }} />
          <span style={{ fontWeight: 500 }}>{record.location}</span>
        </div>
      ),
    },
    {
      title: "Trạng thái",
      key: "status",
      width: 130,
      render: (_: unknown, record: Artisan) => (
        <Tag
          color={record.status === "ACTIVE" ? "success" : "default"}
          style={{
            fontSize: 12,
            padding: "4px 12px",
            borderRadius: 12,
            fontWeight: 500,
          }}
        >
          {record.status === "ACTIVE" ? "✓ Hoạt động" : "○ Không hoạt động"}
        </Tag>
      ),
    },
    {
      title: "Thao tác",
      key: "action",
      width: 140,
      fixed: "right" as const,
      render: (_: unknown, record: Artisan) => (
        <Space size="small">
          <Button
            type="link"
            icon={<EyeOutlined />}
            size="small"
            onClick={() => handleViewDetail(record)}
          >
            Xem chi tiết
          </Button>
          <Button
            type="link"
            icon={<EditOutlined />}
            size="small"
            onClick={() => handleOpenEdit(record)}
            disabled={isFallbackMode}
          >
            Sửa
          </Button>
        </Space>
      ),
    },
  ];

  return (
    <Space orientation="vertical" size="large" style={{ width: "100%" }}>
      <Card
        style={{
          background: "#fff",
          border: "1px solid #e8e8e8",
          boxShadow: "0 2px 8px rgba(0,0,0,0.06)",
        }}
      >
        <Row gutter={[16, 16]} align="middle">
          <Col flex="auto">
            <h2
              style={{
                margin: 0,
                fontSize: 20,
                fontWeight: 600,
                color: "#262626",
              }}
            >
              Quản lý Nghệ nhân
            </h2>
            <p
              style={{
                margin: "4px 0 0 0",
                color: "#8c8c8c",
                fontSize: 14,
              }}
            >
              Quản lý thông tin nghệ nhân và tour liên quan
            </p>
          </Col>
          <Col>
            <Button
              type="primary"
              icon={<PlusOutlined />}
              onClick={handleOpenCreate}
              disabled={isFallbackMode}
            >
              Thêm nghệ nhân
            </Button>
          </Col>
        </Row>
      </Card>

      <ArtisanSummaryCards stats={stats} />

      <Card
        style={{
          background: "#fff",
          border: "1px solid #e8e8e8",
          boxShadow: "0 2px 8px rgba(0,0,0,0.06)",
        }}
      >
        <Row gutter={[16, 16]} align="middle" style={{ marginBottom: 16 }}>
          <Col xs={24} sm={12} md={6}>
            <div style={{ marginBottom: 4, fontSize: 13, color: "#595959" }}>
              Địa điểm
            </div>
            <Select
              style={{ width: "100%" }}
              placeholder="Tất cả địa điểm"
              value={filter.location}
              onChange={(value) => setFilter({ ...filter, location: value })}
            >
              <Select.Option value="all">Tất cả địa điểm</Select.Option>
              {uniqueProvinces.map((province) => (
                <Select.Option key={province} value={province}>
                  {province}
                </Select.Option>
              ))}
            </Select>
          </Col>
          <Col xs={24} sm={12} md={6}>
            <div style={{ marginBottom: 4, fontSize: 13, color: "#595959" }}>
              Trạng thái
            </div>
            <Select
              style={{ width: "100%" }}
              placeholder="Tất cả trạng thái"
              value={filter.status}
              onChange={(value) => setFilter({ ...filter, status: value })}
            >
              <Select.Option value="all">Tất cả trạng thái</Select.Option>
              <Select.Option value="ACTIVE">Hoạt động</Select.Option>
              <Select.Option value="INACTIVE">Không hoạt động</Select.Option>
            </Select>
          </Col>
          <Col xs={24} sm={12} md={8}>
            <div style={{ marginBottom: 4, fontSize: 13, color: "#595959" }}>
              Tìm kiếm
            </div>
            <Input
              placeholder="Tìm theo tên nghệ nhân..."
              prefix={<SearchOutlined style={{ color: "#bfbfbf" }} />}
              value={searchInput}
              onChange={(e) => setSearchInput(e.target.value)}
              onPressEnter={() => setFilter({ ...filter, search: searchInput })}
              allowClear
              onClear={() => {
                setSearchInput("");
                setFilter({ ...filter, search: "" });
              }}
            />
          </Col>
          <Col xs={24} sm={12} md={4}>
            <Button
              style={{ marginTop: 22 }}
              onClick={() => setFilter({ ...filter, search: searchInput })}
            >
              Tìm kiếm
            </Button>
          </Col>
        </Row>

        {fallbackNotice && (
          <Alert
            title={fallbackNotice}
            type="warning"
            showIcon
            style={{ marginBottom: 16 }}
          />
        )}

        {error && (
          <Alert
            title="Lỗi"
            description={error}
            type="error"
            showIcon
            style={{ marginBottom: 16 }}
          />
        )}

        {loading ? (
          <Table
            columns={columns}
            dataSource={[]}
            rowKey="id"
            loading={loading}
            scroll={{ x: 800 }}
            pagination={false}
          />
        ) : filteredArtisans.length === 0 ? (
          <Empty
            description={
              <span>
                {hasActiveFilters
                  ? "Không tìm thấy nghệ nhân nào phù hợp với bộ lọc."
                  : "Chưa có nghệ nhân nào."}
              </span>
            }
            style={{ padding: "48px 0" }}
          >
            {hasActiveFilters && (
              <Button type="primary" onClick={handleClearFilters}>
                Xóa bộ lọc
              </Button>
            )}
          </Empty>
        ) : (
          <Table
            columns={columns}
            dataSource={filteredArtisans}
            rowKey="id"
            loading={loading}
            scroll={{ x: 800 }}
            pagination={{
              pageSize: 10,
              showSizeChanger: true,
              showTotal: (total) => `Tổng ${total} nghệ nhân`,
            }}
          />
        )}
      </Card>

      <Modal
        title="Thêm nghệ nhân mới"
        open={isModalOpen}
        onCancel={() => setIsModalOpen(false)}
        footer={null}
        width={600}
      >
        <Form form={form} layout="vertical">
          <Form.Item
            label="Tài khoản (User)"
            name="userId"
            rules={[{ required: true, message: "Vui lòng chọn user" }]}
          >
            <Select
              placeholder="Chọn user để gán làm nghệ nhân"
              showSearch
              optionFilterProp="label"
              options={userOptions.map((u) => ({
                value: u.id,
                label: `${u.fullName}${u.email ? ` (${u.email})` : ""}`,
              }))}
              onChange={(userId) => {
                const u = userOptions.find((x) => x.id === userId);
                if (u?.fullName) form.setFieldValue("fullName", u.fullName);
              }}
            />
          </Form.Item>
          <Form.Item
            label="Họ tên"
            name="fullName"
            rules={[{ required: true, message: "Vui lòng nhập họ tên" }]}
          >
            <Input placeholder="Họ tên nghệ nhân" />
          </Form.Item>
          <Form.Item
            label="Chuyên môn"
            name="specialization"
            rules={[{ required: true, message: "Vui lòng nhập chuyên môn" }]}
          >
            <Input placeholder="VD: Gốm, Đan lát, Dệt thổ cẩm..." />
          </Form.Item>
          <Form.Item label="Giới thiệu" name="bio">
            <Input.TextArea rows={4} placeholder="Mô tả ngắn về nghệ nhân" />
          </Form.Item>
          <Form.Item label="Ảnh đại diện (URL)" name="profileImageUrl">
            <Input placeholder="https://..." />
          </Form.Item>
          <Form.Item
            label="Hình ảnh (URL)"
            name="images"
            extra="Mỗi URL cách nhau bởi dấu phẩy hoặc xuống dòng"
          >
            <Input.TextArea rows={2} placeholder="https://... , https://..." />
          </Form.Item>
          <Form.Item label="Tỉnh thành" name="provinceId">
            <Select placeholder="Chọn tỉnh thành" allowClear>
              {provinces.map((p) => (
                <Select.Option key={p.id} value={p.id}>
                  {p.name}
                </Select.Option>
              ))}
            </Select>
          </Form.Item>
          <Form.Item label="Địa chỉ xưởng" name="workshopAddress">
            <Input placeholder="Địa chỉ cụ thể" />
          </Form.Item>
          <Form.Item>
            <Space>
              <Button
                type="primary"
                onClick={handleCreateArtisan}
                loading={createLoading}
              >
                Tạo
              </Button>
              <Button onClick={() => setIsModalOpen(false)}>Hủy</Button>
            </Space>
          </Form.Item>
        </Form>
      </Modal>

      <Modal
        title="Chi tiết nghệ nhân"
        open={detailModalOpen}
        onCancel={() => {
          setDetailModalOpen(false);
          setSelectedArtisan(null);
        }}
        footer={[
          <Button
            key="edit"
            type="primary"
            icon={<EditOutlined />}
            onClick={() => {
              setDetailModalOpen(false);
              if (selectedArtisan) handleOpenEdit(selectedArtisan);
            }}
            disabled={isFallbackMode}
          >
            Chỉnh sửa
          </Button>,
          <Button
            key="close"
            onClick={() => {
              setDetailModalOpen(false);
              setSelectedArtisan(null);
            }}
          >
            Đóng
          </Button>,
        ]}
        width={800}
      >
        {selectedArtisan && (
          <PersonDetailCard
            avatarUrl={selectedArtisan.profileImageUrl}
            name={selectedArtisan.name}
            subtitle={selectedArtisan.specialty ? `Nghệ nhân ${selectedArtisan.specialty}` : "Nghệ nhân"}
            status={selectedArtisan.status}
            infoSections={[
              {
                rows: [
                  {
                    label: "Chuyên môn",
                    value: selectedArtisan.specialty,
                    icon: <TrophyOutlined />,
                  },
                  {
                    label: "Địa điểm",
                    value: selectedArtisan.location,
                    icon: <EnvironmentOutlined />,
                  },
                  {
                    label: "Địa chỉ xưởng",
                    value: selectedArtisan.workshopAddress || "Chưa có",
                    icon: <HomeOutlined />,
                  },
                  {
                    label: "Đánh giá",
                    value: `${(selectedArtisan.averageRating ?? 0).toFixed(1)}/5 · ${selectedArtisan.totalTours ?? 0} tour`,
                    icon: <TrophyOutlined />,
                  },
                ],
              },
              {
                title: "Giới thiệu",
                rows: [
                  {
                    label: "",
                    value: selectedArtisan.bio || "Chưa có",
                  },
                ],
              },
            ]}
          />
        )}
      </Modal>

      <Modal
        title="Chỉnh sửa nghệ nhân"
        open={editModalOpen}
        onCancel={() => {
          setEditModalOpen(false);
          setSelectedArtisan(null);
        }}
        footer={
          <div style={{ display: "flex", justifyContent: "space-between" }}>
            <Space>
              {selectedArtisan?.status === "ACTIVE" ? (
                <Popconfirm
                  title="Ẩn nghệ nhân"
                  description="Nghệ nhân sẽ không hiển thị trên trang công khai cho đến khi được hiện lại."
                  onConfirm={() =>
                    selectedArtisan &&
                    handleStatusChange(selectedArtisan, "INACTIVE")
                  }
                  okText="Đồng ý"
                  cancelText="Hủy"
                  okButtonProps={{ danger: true }}
                  disabled={isFallbackMode}
                >
                  <Button danger icon={<EyeInvisibleOutlined />}>
                    Ẩn
                  </Button>
                </Popconfirm>
              ) : (
                <Popconfirm
                  title="Hiện nghệ nhân"
                  description="Nghệ nhân sẽ hiển thị lại trên trang công khai."
                  onConfirm={() =>
                    selectedArtisan &&
                    handleStatusChange(selectedArtisan, "ACTIVE")
                  }
                  okText="Đồng ý"
                  cancelText="Hủy"
                  disabled={isFallbackMode}
                >
                  <Button icon={<EyeOutlined />}>Hiện</Button>
                </Popconfirm>
              )}
              <Popconfirm
                title="Xóa nghệ nhân"
                description="Bạn có chắc muốn xóa nghệ nhân này? Hành động này không thể hoàn tác."
                onConfirm={() =>
                  selectedArtisan && handleDeleteArtisan(selectedArtisan)
                }
                okText="Xóa"
                cancelText="Hủy"
                okButtonProps={{ danger: true }}
                disabled={isFallbackMode}
              >
                <Button danger icon={<DeleteOutlined />}>
                  Xóa
                </Button>
              </Popconfirm>
            </Space>
            <Space>
              <Button
                onClick={() => {
                  setEditModalOpen(false);
                  setSelectedArtisan(null);
                }}
              >
                Hủy
              </Button>
              <Button
                type="primary"
                onClick={handleSaveEdit}
                loading={saving}
                disabled={isFallbackMode}
              >
                Lưu
              </Button>
            </Space>
          </div>
        }
        width={560}
      >
        <Form form={editForm} layout="vertical" style={{ marginTop: 16 }}>
          <Form.Item
            label="Họ tên"
            name="fullName"
            rules={[{ required: true, message: "Vui lòng nhập họ tên" }]}
          >
            <Input placeholder="Họ tên nghệ nhân" />
          </Form.Item>
          <Form.Item
            label="Chuyên môn"
            name="specialization"
            rules={[{ required: true, message: "Vui lòng nhập chuyên môn" }]}
          >
            <Input placeholder="VD: Gốm, Đan lát..." />
          </Form.Item>
          <Form.Item label="Giới thiệu" name="bio">
            <Input.TextArea rows={4} placeholder="Mô tả ngắn về nghệ nhân" />
          </Form.Item>
          <Form.Item label="Ảnh đại diện (URL)" name="profileImageUrl">
            <Input placeholder="https://..." />
          </Form.Item>
          <Form.Item label="Tỉnh thành" name="provinceId">
            <Select placeholder="Chọn tỉnh thành" allowClear>
              {provinces.map((p) => (
                <Select.Option key={p.id} value={p.id}>
                  {p.name}
                </Select.Option>
              ))}
            </Select>
          </Form.Item>
          <Form.Item label="Địa chỉ xưởng" name="workshopAddress">
            <Input placeholder="Địa chỉ cụ thể" />
          </Form.Item>
        </Form>
      </Modal>
    </Space>
  );
}
